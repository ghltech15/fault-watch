---
phase: 02-content-export
plan: 02
type: standard
title: Video Generation with Audio
---

# Plan 02-02: Video Generation with Audio

## Objective

Implement video generation with animated text, transitions, and background audio for TikTok-ready clips.

**Purpose:** Create engaging short-form video content from market data that can be directly uploaded to TikTok/Reels.
**Output:** Working video generation producing 10-15 second clips with animation and audio.

## Execution Context

@./.claude/get-shit-done/workflows/execute-phase.md
@./.claude/get-shit-done/templates/summary.md

## Context

@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-content-export/02-01-SUMMARY.md
@content_generator.py
@fault_watch.py

**Depends on:** 02-01 (ContentGenerator class, image templates)
**Tech added in 02-01:** Pillow, MoviePy, kaleido

## Tasks

<task type="auto">
  <name>Add background audio assets</name>
  <files>assets/audio/</files>
  <action>
    Create assets/audio/ directory.

    Download royalty-free audio clips (or create simple ones):
    1. **alert_tone.mp3** - Short attention-grabbing sound (1-2 sec)
       Use: ffmpeg to generate a simple beep/alert tone
       `ffmpeg -f lavfi -i "sine=frequency=800:duration=0.3" -af "afade=t=out:st=0.2:d=0.1" assets/audio/alert_tone.mp3`

    2. **dramatic_bg.mp3** - Low rumble/tension background (15 sec loop)
       Use: ffmpeg to generate low frequency drone
       `ffmpeg -f lavfi -i "sine=frequency=60:duration=15" -af "volume=0.3,afade=t=in:st=0:d=1,afade=t=out:st=14:d=1" assets/audio/dramatic_bg.mp3`

    3. **countdown_tick.mp3** - Tick sound for countdown videos (0.5 sec)
       Use: ffmpeg click sound
       `ffmpeg -f lavfi -i "sine=frequency=1000:duration=0.1" assets/audio/countdown_tick.mp3`

    Add assets/ to .gitignore exception (keep audio files in repo).

    Note: These are placeholder sounds. User can replace with better audio later.
  </action>
  <verify>
    ls assets/audio/*.mp3
    # Should show 3 audio files
  </verify>
  <done>3 audio assets created for video generation</done>
</task>

<task type="auto">
  <name>Implement video generation core</name>
  <files>content_generator.py</files>
  <action>
    Update ContentGenerator class to implement generate_video():

    1. **VideoConfig dataclass:**
       - duration: int = 10 (seconds)
       - fps: int = 30
       - include_audio: bool = True
       - audio_file: Optional[str] = "assets/audio/dramatic_bg.mp3"

    2. **generate_video(data, template, config: VideoConfig) -> Path:**
       - Create base image using existing template methods
       - Use MoviePy to create video from images
       - Add text animations (fade in, scale up)
       - Add audio track
       - Export to content-output/videos/{template}_{timestamp}.mp4

    3. **Animation helpers:**
       - _animate_text_reveal(clip, text, position, duration) - Text fades in
       - _animate_number_count(clip, start, end, position, duration) - Numbers count up
       - _add_flash_effect(clip, color, timing) - Brief color flash for impact

    4. **Composition:**
       - Background: solid color or gradient image
       - Foreground: text layers with animations
       - Audio: background track + optional sound effects

    Use MoviePy's TextClip, ImageClip, CompositeVideoClip, AudioFileClip.

    Video specs: 1080x1920, 30fps, H.264 codec, AAC audio.
  </action>
  <verify>
    python -c "
from content_generator import ContentGenerator, TemplateType, VideoConfig
c = ContentGenerator()
config = VideoConfig(duration=5)  # Short test
path = c.generate_video({'price': 95.00, 'change': 8.5, 'asset': 'SILVER'}, TemplateType.PRICE_ALERT, config)
print(f'Created: {path}')
"
  </verify>
  <done>Video generation working with MoviePy, producing MP4 files</done>
</task>

<task type="auto">
  <name>Create video templates with animations</name>
  <files>content_generator.py</files>
  <action>
    Implement animated video versions of each template:

    1. **PRICE_ALERT video (10 sec):**
       - 0-1s: Flash + alert sound, "BREAKING" text appears
       - 1-3s: Asset name fades in from top
       - 3-6s: Price counts up to final value (dramatic)
       - 6-8s: Percentage change slides in with arrow
       - 8-10s: Hold final frame, fade to black

    2. **COUNTDOWN video (10 sec):**
       - 0-2s: "DEADLINE" text with pulse effect
       - 2-5s: Days number counts down from +5 to actual
       - 5-7s: "DAYS REMAINING" fades in
       - 7-10s: Event name and date appear, tick sounds

    3. **BANK_CRISIS video (12 sec):**
       - 0-1s: Red flash, alert sound
       - 1-3s: Bank name slams in
       - 3-6s: Stock price with dramatic drop animation
       - 6-9s: "CRISIS" label pulses
       - 9-12s: Exposure/loss numbers appear

    4. **DAILY_SUMMARY video (15 sec):**
       - 0-2s: "DAILY RECAP" header
       - 2-10s: Each metric appears sequentially (2s each)
       - 10-13s: Risk index with color
       - 13-15s: Date and watermark

    Background audio plays throughout. Sound effects at key moments.
  </action>
  <verify>
    python -c "
from content_generator import ContentGenerator, TemplateType, VideoConfig
c = ContentGenerator()
# Test all 4 templates
for t in [TemplateType.PRICE_ALERT, TemplateType.COUNTDOWN, TemplateType.BANK_CRISIS, TemplateType.DAILY_SUMMARY]:
    path = c.generate_video({'price': 89, 'change': 5, 'asset': 'SILVER', 'days': 20, 'bank': 'MS', 'risk': 7.5}, t)
    print(f'{t.name}: {path}')
"
  </verify>
  <done>All 4 video templates with animations and audio working</done>
</task>

## Verification

Before declaring plan complete:
- [ ] Audio files exist in assets/audio/
- [ ] generate_video() produces valid MP4 files
- [ ] Videos are 1080x1920 at 30fps
- [ ] Text animations render correctly
- [ ] Audio plays in generated videos
- [ ] All 4 templates produce working videos

## Success Criteria

- Video generation with MoviePy working
- 4 animated video templates (PRICE_ALERT, COUNTDOWN, BANK_CRISIS, DAILY_SUMMARY)
- Background audio integrated
- Sound effects at key moments
- Videos export to content-output/videos/
- 9:16 aspect ratio, 30fps, H.264/AAC

## Output

After completion, create `.planning/phases/02-content-export/02-02-SUMMARY.md`
